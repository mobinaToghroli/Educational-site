{% extends 'base/base.html' %}
{% load static %}
{% block contents %}
<html lang="fa" dir="rtl" class="font-vazir">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تغییر گذرواژه - سیستم جامع دانشگاهی گلستان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/globals.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        vazir: ['"Vazirmatn"', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="flex h-screen bg-gray-50 dark:bg-slate-900 font-vazir">
    <!-- Sidebar -->
  <aside id="sidebar" class="bg-white dark:bg-slate-800 shadow-md h-full flex-col hidden md:flex md:w-64">
    <!-- User Profile Section -->
    <div class="p-4 border-b border-gray-200 dark:border-slate-700">
      <div class="flex items-center space-x-3 space-x-reverse">
        <div class="bg-gray-200 border-2 border-dashed rounded-xl w-12 h-12 flex items-center justify-center">
          <span class="text-gray-600 text-lg font-bold">
            {{ user.first_name|first|default:user.username|first }}
          </span>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-900 dark:text-white">
            {% if user.first_name and user.last_name %}
              {{ user.first_name }} {{ user.last_name }}
            {% else %}
              {{ user.username }}
            {% endif %}
          </p>
          <p class="text-xs text-gray-500 dark:text-gray-400">
            {% if request.user.username == 'taha' %}
              401123456789
            {% elif request.user.username == 'zohreh' %}
              401987654321
            {% else %}
              {{ user.username }}
            {% endif %}
          </p>
        </div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="flex-1 overflow-y-auto py-4">
      <ul class="space-y-1 px-2">
        <li>
          <a href="{% url 'home' %}" class="flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
            <span>پیشخوان خدمات</span>
          </a>
        </li>
        <li>
          <a href="{% url 'graduation_request' %}" class="flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
            </svg>
            <span>درخواست فارغ‌التحصیلی</span>
          </a>
        </li>
        <li>
          <a href="{% url 'schedule' %}" class="flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
            </svg>
            <span>برنامه امتحانی</span>
          </a>
        </li>
        <li>
          <a href="{% url 'user_profile_page' %}" class="flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
            </svg>
            <span>اطلاعات جامع دانشجو</span>
          </a>
        </li>
        <li>
          <a href="{% url 'change_password' %}" class="flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
            </svg>
            <span>تغییر رمزعبور</span>
          </a>
        </li>
          <li>
          <a href="{% url 'my_requests' %}" class="flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
            </svg>
            <span>درخواست های دانشجو</span>
          </a>
        </li>
        <li>
          <form method="POST" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="w-full text-right flex items-center space-x-3 space-x-reverse px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
              </svg>
              <span>خروج</span>
            </button>
          </form>
        </li>
      </ul>
    </nav>
  </aside>

    <div id="sidebar-overlay" class="fixed inset-0 z-30 bg-black bg-opacity-50 md:hidden hidden"></div>

    <div class="flex flex-col flex-1 w-full">
        <header class="bg-white dark:bg-slate-800 shadow-md py-4 px-6 sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <button id="sidebar-toggle" class="md:hidden p-2 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700">
                    <svg id="sidebar-icon" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    <svg id="sidebar-close-icon" class="h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <div class="text-xl font-bold text-indigo-600 dark:text-indigo-400 font-vazir">سیستم جامع دانشگاهی گلستان</div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button id="dark-mode-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-slate-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-slate-600">
                        <svg id="light-icon" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg id="dark-icon" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                    <div id="user-dropdown" class="relative">
                        <button id="user-dropdown-btn" class="flex items-center space-x-2 space-x-reverse p-2 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700">
                            <div class="bg-gray-200 border-2 border-dashed rounded-xl w-8 h-8"></div>
                            <span class="hidden md:inline text-gray-700 dark:text-gray-300">{{ user.first_name }} {{ user.last_name }}</span>
                        </button>
                        <div id="user-dropdown-menu" class="absolute left-0 mt-2 w-48 bg-white dark:bg-slate-800 rounded-md shadow-lg py-1 z-50 hidden">
                            <div class="px-4 py-2 border-b border-gray-200 dark:border-slate-700">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">{{ user.first_name }} {{ user.last_name }}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ user.userid }}</p>
                            </div>
                            <a href="{% url 'user_profile_page' %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700">مشاهده پروفایل</a>
                            <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-700 flex items-center">
                                <svg class="h-4 w-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                                خروج
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 md:p-6">
            <div class="max-w-7xl mx-auto">
                <div class="max-w-2xl mx-auto space-y-6">
                    <h1 class="text-2xl font-bold text-gray-800 dark:text-white">تغییر گذرواژه</h1>

                    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-6">
                        <form method="POST" id="change-password-form" class="space-y-6">
                            {% csrf_token %}

                            <div>
                                <label for="{{ form.current_password.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    {{ form.current_password.label }}
                                </label>
                                <div class="relative">
                                    {{ form.current_password }}
                                    <button type="button" id="toggle-current-password" class="absolute inset-y-0 left-0 pl-3 flex items-center">
                                        <svg id="eye-current" class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                        <svg id="eye-slash-current" class="h-5 w-5 text-gray-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                                        </svg>
                                    </button>
                                </div>
                                {% if form.current_password.errors %}
                                    <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                        {{ form.current_password.errors.0 }}
                                    </p>
                                {% endif %}
                            </div>

                            <div>
                                <label for="{{ form.new_password.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    {{ form.new_password.label }}
                                </label>
                                <div class="relative">
                                    {{ form.new_password }}
                                    <button type="button" id="toggle-new-password" class="absolute inset-y-0 left-0 pl-3 flex items-center">
                                        <svg id="eye-new" class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                        <svg id="eye-slash-new" class="h-5 w-5 text-gray-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                                        </svg>
                                    </button>
                                </div>
                                {% if form.new_password.errors %}
                                    <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                        {{ form.new_password.errors.0 }}
                                    </p>
                                {% endif %}

                                <!-- Password Strength Indicator -->
                                <div class="mt-2">
                                    <div class="flex justify-between mb-1">
                                        <span class="text-xs text-gray-600 dark:text-gray-400">قدرت رمز عبور:</span>
                                        <span id="strength-text" class="text-xs text-gray-600 dark:text-gray-400"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2">
                                        <div id="strength-bar" class="h-2 rounded-full"></div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label for="{{ form.confirm_password.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                    {{ form.confirm_password.label }}
                                </label>
                                <div class="relative">
                                    {{ form.confirm_password }}
                                    <button type="button" id="toggle-confirm-password" class="absolute inset-y-0 left-0 pl-3 flex items-center">
                                        <svg id="eye-confirm" class="h-5 w-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                        <svg id="eye-slash-confirm" class="h-5 w-5 text-gray-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                                        </svg>
                                    </button>
                                </div>
                                {% if form.confirm_password.errors %}
                                    <p class="mt-1 text-sm text-red-600 dark:text-red-500">
                                        {{ form.confirm_password.errors.0 }}
                                    </p>
                                {% endif %}
                            </div>

                            <!-- Display form-level errors -->
                            {% if form.non_field_errors %}
                                <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                                    <p class="text-sm text-red-600 dark:text-red-500">
                                        {{ form.non_field_errors.0 }}
                                    </p>
                                </div>
                            {% endif %}

                            <!-- Display success messages -->
                            {% if messages %}
                                {% for message in messages %}
                                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                                        <p class="text-sm text-green-600 dark:text-green-400">
                                            {{ message }}
                                        </p>
                                    </div>
                                {% endfor %}
                            {% endif %}

                            <div class="pt-4">
                                <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    تغییر گذرواژه
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4">
                        <h3 class="font-medium text-yellow-800 dark:text-yellow-200">راهنمای ایجاد رمز عبور ایمن:</h3>
                        <ul class="mt-2 text-sm text-yellow-700 dark:text-yellow-300 list-disc pr-5 space-y-1">
                            <li>حداقل 8 کاراکتر داشته باشد</li>
                            <li>حاوی حداقل یک عدد باشد</li>
                            <li>حاوی حداقل یک حرف بزرگ و یک حرف کوچک باشد</li>
                            <li>از کاراکترهای خاص استفاده کند (!@#$%^&amp;*)</li>
                            <li>از اطلاعات شخصی ساده استفاده نکند</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add CSS for form styling -->
    <style>
        /* Add form input styling */
        .form-input {
            width: 100%;
            padding: 0.75rem;
            padding-right: 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background-color: white;
            color: #1f2937;
            direction: rtl;
            transition: all 0.2s;
        }

        .dark .form-input {
            border-color: #475569;
            background-color: #1e293b;
            color: white;
        }

        .form-input:focus {
            outline: none;
            ring: 2px;
            ring-color: #4f46e5;
            border-color: #4f46e5;
        }

        /* Toggle password button styling */
        .password-toggle-btn {
            cursor: pointer;
            transition: color 0.2s;
        }

        .password-toggle-btn:hover {
            color: #4f46e5;
        }

        /* Password strength colors */
        .strength-weak {
            background-color: #ef4444;
            width: 25%;
        }

        .strength-fair {
            background-color: #f59e0b;
            width: 50%;
        }

        .strength-good {
            background-color: #10b981;
            width: 75%;
        }

        .strength-strong {
            background-color: #059669;
            width: 100%;
        }

        /* Custom styles for form errors */
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .dark .error-message {
            color: #f87171;
        }
    </style>

    <!-- JavaScript for password toggle and strength meter -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get form field IDs
            const currentPasswordField = document.querySelector('[id$="current_password"]');
            const newPasswordField = document.querySelector('[id$="new_password"]');
            const confirmPasswordField = document.querySelector('[id$="confirm_password"]');

            // Toggle for current password
            const toggleCurrentBtn = document.getElementById('toggle-current-password');
            const eyeCurrent = document.getElementById('eye-current');
            const eyeSlashCurrent = document.getElementById('eye-slash-current');

            if (toggleCurrentBtn && currentPasswordField) {
                toggleCurrentBtn.addEventListener('click', function() {
                    const type = currentPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    currentPasswordField.setAttribute('type', type);
                    eyeCurrent.classList.toggle('hidden');
                    eyeSlashCurrent.classList.toggle('hidden');
                });
            }

            // Toggle for new password
            const toggleNewBtn = document.getElementById('toggle-new-password');
            const eyeNew = document.getElementById('eye-new');
            const eyeSlashNew = document.getElementById('eye-slash-new');

            if (toggleNewBtn && newPasswordField) {
                toggleNewBtn.addEventListener('click', function() {
                    const type = newPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    newPasswordField.setAttribute('type', type);
                    eyeNew.classList.toggle('hidden');
                    eyeSlashNew.classList.toggle('hidden');
                });
            }

            // Toggle for confirm password
            const toggleConfirmBtn = document.getElementById('toggle-confirm-password');
            const eyeConfirm = document.getElementById('eye-confirm');
            const eyeSlashConfirm = document.getElementById('eye-slash-confirm');

            if (toggleConfirmBtn && confirmPasswordField) {
                toggleConfirmBtn.addEventListener('click', function() {
                    const type = confirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
                    confirmPasswordField.setAttribute('type', type);
                    eyeConfirm.classList.toggle('hidden');
                    eyeSlashConfirm.classList.toggle('hidden');
                });
            }

            // Password strength meter
            if (newPasswordField) {
                newPasswordField.addEventListener('input', function() {
                    const password = this.value;
                    const strengthBar = document.getElementById('strength-bar');
                    const strengthText = document.getElementById('strength-text');

                    let strength = 0;
                    let text = '';
                    let colorClass = '';

                    // Check password strength
                    if (password.length >= 8) strength++;
                    if (/[A-Z]/.test(password)) strength++;
                    if (/[a-z]/.test(password)) strength++;
                    if (/[0-9]/.test(password)) strength++;
                    if (/[^A-Za-z0-9]/.test(password)) strength++;

                    // Update UI
                    switch(strength) {
                        case 0:
                        case 1:
                            text = 'ضعیف';
                            colorClass = 'strength-weak';
                            break;
                        case 2:
                        case 3:
                            text = 'متوسط';
                            colorClass = 'strength-fair';
                            break;
                        case 4:
                            text = 'خوب';
                            colorClass = 'strength-good';
                            break;
                        case 5:
                            text = 'قوی';
                            colorClass = 'strength-strong';
                            break;
                    }

                    strengthText.textContent = text;
                    strengthBar.className = 'h-2 rounded-full ' + colorClass;

                    // Update text color based on strength
                    if (strength <= 1) {
                        strengthText.className = 'text-xs text-red-600 dark:text-red-400';
                    } else if (strength <= 3) {
                        strengthText.className = 'text-xs text-yellow-600 dark:text-yellow-400';
                    } else {
                        strengthText.className = 'text-xs text-green-600 dark:text-green-400';
                    }
                });
            }

            // Real-time password confirmation check
            if (newPasswordField && confirmPasswordField) {
                confirmPasswordField.addEventListener('input', function() {
                    const newPassword = newPasswordField.value;
                    const confirmPassword = this.value;
                    const errorElement = this.nextElementSibling;

                    if (confirmPassword && newPassword !== confirmPassword) {
                        if (!errorElement || !errorElement.classList.contains('error-message')) {
                            const errorMsg = document.createElement('p');
                            errorMsg.className = 'mt-1 text-sm text-red-600 dark:text-red-500 error-message';
                            errorMsg.textContent = 'رمز عبور جدید و تکرار آن مطابقت ندارند';
                            this.parentNode.insertBefore(errorMsg, errorElement);
                        }
                    } else if (errorElement && errorElement.classList.contains('error-message')) {
                        errorElement.remove();
                    }
                });
            }
        });
    </script>

    <!-- Static files -->
    <script src="{% static 'js/theme.js' %}"></script>
    <script src="{% static 'js/header.js' %}"></script>
    <script src="{% static 'js/sidebar.js' %}"></script>
    <script src="{% static 'js/layout.js' %}"></script>
</body>
</html>
{% endblock %}